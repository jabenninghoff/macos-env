#!/bin/sh
if ! /usr/bin/which -s rbenv; then exit; fi

LATEST=$(rbenv install -l | grep '^\d' | tail -1)
GLOBAL=$(rbenv global)

if [ "$GLOBAL" = "$LATEST" ]
then
	exit 0
else
	printf "installed ruby version (%s) does not match latest version (%s)\n" "$GLOBAL" "$LATEST"
	printf "to install:\n  rbenv install %s && rbenv global %s\n" "$LATEST" "$LATEST"
	printf "or:\n  brew rbenv-sync && rbenv global %s\n\n" "$LATEST"
	if [ "$(/bin/ls -F "$HOME/.rbenv/versions" | grep -c '/$')" -eq 0 ]
	then
		printf "brew rbenv-sync && rbenv global %s" "$LATEST" | pbcopy
	else
		printf "rbenv install %s && rbenv global %s" "$LATEST" "$LATEST" | pbcopy
	fi
	exit 1
fi
